<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>PHP Framework</title><link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"></link><link rel="stylesheet" href="../css/template.css" type="text/css"></link><script type="text/javascript" src="../js/jquery-1.7.1.min.js"></script><script type="text/javascript" src="../js/bootstrap.min.js"></script><script type="text/javascript" src="../js/template.js"></script></head><body><div id="content"><h1 class="file">lib/om/BaseTable.php<a href="../source/lib/om/BaseTable.php.html" role="button" class="pull-right btn btn-default"><i class="fa fa-2x fa-code"></i></a></h1><div id="file-nav-box"><div id="file-nav-options">
              Show:
              <img src="../images/icons/visibility_public.png" alt="Public" id="show-public"></img><img src="../images/icons/visibility_protected.png" alt="Protected" id="show-protected"></img><img src="../images/icons/visibility_private.png" alt="Private" id="show-private"></img><span class="attribute" id="show-inherited">inherited</span></div><div id="file-nav-container"><ul id="file-nav"><li><a href="#classes"><img src="../images/icons/class.png" alt="Class" height="14"></img>
                          Classes
                      </a><ul><li><a href="#\BaseTable">\BaseTable</a></li></ul></li></ul><div style="clear: left;"></div></div><div id="file-nav-tab">
              Table of Contents
          </div></div><a name="top" class="anchor"></a><div id="file-description"><div class="long-description"></div></div><a name="classes" class="anchor"></a><a id="\BaseTable" class="anchor"></a><h2 class="class">\BaseTable<div class="to-top"><a href="#top">jump to top</a></div></h2><div class="class"><small class="package"><b>Package: </b>ShippingAPI\om</small><div class="short-description">A class for managing CRUD database functionality.</div><div class="long-description">* MODIFIED from standard to put a "created date" in automatically. All children must have a field nicknamed "created".

In your extension of this class, you should fill in the following:

$table_name
$fields
$field_nicks_map
$searchable_nicks
$sortable_nicks
$editable_nicks



Assumption:
The nickname 'id' will be used to represent the primary key.
If this is not the case, you can set $constructor_key to the primary key nickname.</div><dl class="class-info"><dt>Children</dt><dd><a href="../files/lib.auth.PermissionsModule.html#\PermissionsModule">\PermissionsModule</a></dd><dd><a href="../files/lib.om.Example.html#\Example">\Example</a></dd><dd><a href="../files/lib.auth.User.html#\User">\User</a></dd><dd><a href="../files/lib.auth.ActiveGuest.html#\ActiveGuest">\ActiveGuest</a></dd><dd><a href="../files/lib.auth.BannedUser.html#\BannedUser">\BannedUser</a></dd><dd><a href="../files/lib.auth.ActiveUser.html#\ActiveUser">\ActiveUser</a></dd><dd><a href="../files/lib.auth.PermissionsPage.html#\PermissionsPage">\PermissionsPage</a></dd><dd><a href="../files/lib.auth.Permission.html#\Permission">\Permission</a></dd><dt>Author</dt><dd>kenstclair
         
    </dd></dl><h3>Properties</h3><div><a id="\BaseTable::$constructor_key" class="anchor"></a><div class="property public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png" alt="&gt;"></img><img src="../images/icons/arrow_down.png" alt="V" style="display: none;"></img></a><code class="title"><img src="../images/icons/property.png" alt="Property"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img>\unknown_type <span class="highlight">$constructor_key</span> = "id"</code><div class="description"><span class="attribute">static</span><div class="short-description">The nickname of the column used to construct a new instance.</div></div><div class="code-tabs"><div class="long-description">Usually this will be 'id'. You can customize it for different
primary keys. For example, in things like user accounts tables,
you may want to change this to 'username'

This should always be a unique column, if not the primary key</div><strong>Default value</strong><code>"id"</code><strong>Details</strong><dl class="property-info"><dt>Type</dt><dd><a href="../files/unknown_type.html">\unknown_type</a></dd></dl></div><div class="clear"></div></div><a id="\BaseTable::$editable_nicks" class="anchor"></a><div class="property public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png" alt="&gt;"></img><img src="../images/icons/arrow_down.png" alt="V" style="display: none;"></img></a><code class="title"><img src="../images/icons/property.png" alt="Property"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img>\unknown_type <span class="highlight">$editable_nicks</span> = array()</code><div class="description"><span class="attribute">static</span><div class="short-description">A list of fields that can be edited. USE NICKNAMES.</div></div><div class="code-tabs"><div class="long-description"></div><strong>Default value</strong><code>array()</code><strong>Details</strong><dl class="property-info"><dt>Type</dt><dd><a href="../files/unknown_type.html">\unknown_type</a></dd></dl></div><div class="clear"></div></div><a id="\BaseTable::$field_nicks_map" class="anchor"></a><div class="property public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png" alt="&gt;"></img><img src="../images/icons/arrow_down.png" alt="V" style="display: none;"></img></a><code class="title"><img src="../images/icons/property.png" alt="Property"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img>\unknown_type <span class="highlight">$field_nicks_map</span> = array()</code><div class="description"><span class="attribute">static</span><div class="short-description">A mapping of nicknames to actual table names, like so:
array(
	"id" => "p_id",
	"nickname" => "table_column_name"
)</div></div><div class="code-tabs"><div class="long-description">When constructing queries, use static::$field_nicks_map['nickname']
to represent your field names. This will give you a layer of indirection
that will allow you to change your database field names without having
to update all your queries.</div><strong>Default value</strong><code>array()</code><strong>Details</strong><dl class="property-info"><dt>Type</dt><dd><a href="../files/unknown_type.html">\unknown_type</a></dd></dl></div><div class="clear"></div></div><a id="\BaseTable::$loaded" class="anchor"></a><div class="property protected"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png" alt="&gt;"></img><img src="../images/icons/arrow_down.png" alt="V" style="display: none;"></img></a><code class="title"><img src="../images/icons/property.png" alt="Property"></img><img src="../images/icons/visibility_protected.png" style="margin-right: 5px" alt="protected"></img><span class="highlight">$loaded</span> = false</code><div class="description"></div><div class="code-tabs"><div class="long-description"></div><strong>Default value</strong><code>false</code><strong>Details</strong><dl class="property-info"><dt>Type</dt><dd>n/a</dd></dl></div><div class="clear"></div></div><a id="\BaseTable::$searchable_nicks" class="anchor"></a><div class="property public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png" alt="&gt;"></img><img src="../images/icons/arrow_down.png" alt="V" style="display: none;"></img></a><code class="title"><img src="../images/icons/property.png" alt="Property"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img>\unknown_type <span class="highlight">$searchable_nicks</span> = array()</code><div class="description"><span class="attribute">static</span><div class="short-description">A list of fields that can be searched. USE NICKNAMES.</div></div><div class="code-tabs"><div class="long-description">Implementation note: All searchable nicks should be indexed.</div><strong>Default value</strong><code>array()</code><strong>Details</strong><dl class="property-info"><dt>Type</dt><dd><a href="../files/unknown_type.html">\unknown_type</a></dd></dl></div><div class="clear"></div></div><a id="\BaseTable::$sortable_nicks" class="anchor"></a><div class="property public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png" alt="&gt;"></img><img src="../images/icons/arrow_down.png" alt="V" style="display: none;"></img></a><code class="title"><img src="../images/icons/property.png" alt="Property"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img>\unknown_type <span class="highlight">$sortable_nicks</span> = array()</code><div class="description"><span class="attribute">static</span><div class="short-description">A list of fields that can be sorted. USE NICKNAMES.</div></div><div class="code-tabs"><div class="long-description"></div><strong>Default value</strong><code>array()</code><strong>Details</strong><dl class="property-info"><dt>Type</dt><dd><a href="../files/unknown_type.html">\unknown_type</a></dd></dl></div><div class="clear"></div></div><a id="\BaseTable::$table_name" class="anchor"></a><div class="property public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png" alt="&gt;"></img><img src="../images/icons/arrow_down.png" alt="V" style="display: none;"></img></a><code class="title"><img src="../images/icons/property.png" alt="Property"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img>\unknown_type <span class="highlight">$table_name</span> = ""</code><div class="description"><span class="attribute">static</span><div class="short-description">The name of the table in the database. Use to construct queries</div></div><div class="code-tabs"><div class="long-description"></div><strong>Default value</strong><code>""</code><strong>Details</strong><dl class="property-info"><dt>Type</dt><dd><a href="../files/unknown_type.html">\unknown_type</a></dd></dl></div><div class="clear"></div></div></div><h3>Methods</h3><div><a id="\BaseTable::__construct()" class="anchor"></a><div class="method public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img><span class="highlight">__construct</span><span class="nb-faded-text">(<a href="../files/unknown_type.html">\unknown_type</a> $id,  $load = true,  $row = null)</span> : void</code><div class="description"><p class="short_description">Load a database entry by its constructor key.</p></div><div class="code-tabs"><div class="long-description">Constructor key defaults to 'id', but can be changed in subclasses.

Additional options are for loading presearched data.
Pass $load=false and $row=array to load a row from
a record into this object</div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$id</th><td><a href="../files/unknown_type.html">\unknown_type</a></td><td><em></em></td></tr><tr><th>$load</th><td></td><td><em></em></td></tr><tr><th>$row</th><td></td><td><em></em></td></tr></table></div><div class="clear"></div></div><a id="\BaseTable::constructFromRecord()" class="anchor"></a><div class="method public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img><span class="highlight">constructFromRecord</span><span class="nb-faded-text">(<a href="../files/unknown_type.html">\unknown_type</a> $row)</span> : void</code><div class="description"><span class="attribute">static</span><p class="short_description">Process an individual search result row into an object</p></div><div class="code-tabs"><div class="long-description">Left public because of scoping issues when passing functions around</div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$row</th><td><a href="../files/unknown_type.html">\unknown_type</a></td><td><em></em></td></tr></table></div><div class="clear"></div></div><a id="\BaseTable::create()" class="anchor"></a><div class="method public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img><span class="highlight">create</span><span class="nb-faded-text">(<a href="../files/hash.html">\hash</a> $knownData)</span> : void</code><div class="description"><span class="attribute">static</span><p class="short_description">Create a new database entry</p></div><div class="code-tabs"><div class="long-description">MODIFIED from standard to put a created date in automatically. All children must have a field nicknamed "created".

Separated from __construct because of a data leak in the previous project that hinged on conditional creation of entries based on input to the function.

Accepts a hash of known values to put into the row, with keys as field nicknames and values as table values.

Assumption:
An autoincrement primary key will have a nickname 'id'

Assumption:
If the primary/constructor key is not autoincrement, you will have provided it in the $knowndata</div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$knownData</th><td><a href="../files/hash.html">\hash</a></td><td><em><p>array("field_nickname" => "value", etc)</p></em></td></tr></table></div><div class="clear"></div></div><a id="\BaseTable::destroy()" class="anchor"></a><div class="method public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img><span class="highlight">destroy</span><span class="nb-faded-text">()</span> : void</code><div class="description"><p class="short_description">Destroy the record.</p></div><div class="code-tabs"><div class="long-description">Deletes the record from the database.

Override to create a soft-delete.</div></div><div class="clear"></div></div><a id="\BaseTable::genericSearch()" class="anchor"></a><div class="method protected"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_protected.png" style="margin-right: 5px" alt="protected"></img><span class="highlight">genericSearch</span><span class="nb-faded-text">( $searchTerm)</span> : void</code><div class="description"><span class="attribute">static</span><p class="short_description">Search any of the searchable fields for the search term.</p></div><div class="code-tabs"><div class="long-description"></div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$searchTerm</th><td></td><td><em></em></td></tr></table></div><div class="clear"></div></div><a id="\BaseTable::getAll()" class="anchor"></a><div class="method public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img><span class="highlight">getAll</span><span class="nb-faded-text">()</span> : void</code><div class="description"><span class="attribute">static</span><p class="short_description">retrieve all rows from the table</p></div><div class="code-tabs"><div class="long-description"></div></div><div class="clear"></div></div><a id="\BaseTable::markLoaded()" class="anchor"></a><div class="method protected"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_protected.png" style="margin-right: 5px" alt="protected"></img><span class="highlight">markLoaded</span><span class="nb-faded-text">(<a href="../files/unknown_type.html">\unknown_type</a> $objs)</span> : void</code><div class="description"><span class="attribute">static</span><p class="short_description">Mark the objects as properly loaded.</p></div><div class="code-tabs"><div class="long-description">Call this only when you have set all of the attributes on
the object from the database.</div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$objs</th><td><a href="../files/unknown_type.html">\unknown_type</a></td><td><em></em></td></tr></table></div><div class="clear"></div></div><a id="\BaseTable::nicks_to_fields()" class="anchor"></a><div class="method protected"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_protected.png" style="margin-right: 5px" alt="protected"></img><span class="highlight">nicks_to_fields</span><span class="nb-faded-text">(<a href="../files/unknown_type.html">\unknown_type</a> $arr)</span> : void</code><div class="description"><span class="attribute">static</span><p class="short_description">Returns an array of the actual field names, given an array of the nicknames.</p></div><div class="code-tabs"><div class="long-description"></div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$arr</th><td><a href="../files/unknown_type.html">\unknown_type</a></td><td><em></em></td></tr></table></div><div class="clear"></div></div><a id="\BaseTable::processQueryToObjects()" class="anchor"></a><div class="method protected"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_protected.png" style="margin-right: 5px" alt="protected"></img><span class="highlight">processQueryToObjects</span><span class="nb-faded-text">(<a href="../files/unknown_type.html">\unknown_type</a> $query)</span> : void</code><div class="description"><span class="attribute">static</span><p class="short_description">A utility function to hold the frequently repeated
code that happens when you write a simple query
and need it processed to objects.</p></div><div class="code-tabs"><div class="long-description">Since it is marking the objects as loaded, please make
sure that your query is "SELECT *..." if you are using
this to load the objects. Objects that are incorrectly
marked as loaded can destroy data in the database when
saved.</div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$query</th><td><a href="../files/unknown_type.html">\unknown_type</a></td><td><em></em></td></tr></table></div><div class="clear"></div></div><a id="\BaseTable::save()" class="anchor"></a><div class="method public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img><span class="highlight">save</span><span class="nb-faded-text">(array $fields_to_save = null)</span> : void</code><div class="description"><p class="short_description">Save the values in the object to the db.</p></div><div class="code-tabs"><div class="long-description">Will throw an error if it thinks that the object hasn't
had all the attributes loaded and you try to save all fields.
This will occur when creating the object and populating it with
data from an externally retrieved record. Since the object didn't create
the record, it doesn't trust that it has all the object's data in it.
If it doesn't have all the data, then a save could overwrite valid data
with an empty field.

The error is bypassed by specifying which fields you want
to save. If you can specify the fields you want to save, then
you've probably loaded them.</div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$fields_to_save</th><td>array</td><td><em><p>field nicknames</p></em></td></tr></table></div><div class="clear"></div></div><a id="\BaseTable::search()" class="anchor"></a><div class="method public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img><span class="highlight">search</span><span class="nb-faded-text">( $searchHashOrTerm)</span> : void</code><div class="description"><span class="attribute">static</span><p class="short_description">Basic search for records</p></div><div class="code-tabs"><div class="long-description">This function allows two basic types of search:
1) The most generic search -> search all $searchable_nicks for a phrase that contains the search term. (field LIKE '%term%' OR field LIKE '%term%')
2) The most restrictive search -> search only the listed fields for the exact values provided. (field = term AND field = term)

All other implementations need to be written for each class. Please do not let your SQL
queries creep out of the objects and into the controllers.

Returns an array of instantiated objects.
**An empty result set will return an empty array.

-krs Should I write this? Or leave most of the searching to be written independently so the sql doesn't creep into the controller.</div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$searchHashOrTerm</th><td></td><td><em></em></td></tr></table></div><div class="clear"></div></div><a id="\BaseTable::set()" class="anchor"></a><div class="method public"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_public.png" style="margin-right: 5px" alt="public"></img><span class="highlight">set</span><span class="nb-faded-text">( $nick,  $value, boolean $save = true)</span> : void</code><div class="description"><p class="short_description">Set the value of a field, by nickname.</p></div><div class="code-tabs"><div class="long-description">Automatically saves the field to the db.

Can be set "softly" by setting the $save param to false.
Data will be set in this object, but not saved in the db.
You must then manually call $this->save() to save the data to the db.</div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$nick</th><td></td><td><em></em></td></tr><tr><th>$value</th><td></td><td><em></em></td></tr><tr><th>$save</th><td>boolean</td><td><em><p>if omitted, the value is saved to the database. if anything other than boolean true is passed, it will not save to the db.</p></em></td></tr></table></div><div class="clear"></div></div><a id="\BaseTable::targetedSearch()" class="anchor"></a><div class="method protected"><a href="#" class="gripper"><img src="../images/icons/arrow_right.png"></img><img src="../images/icons/arrow_down.png" style="display: none;"></img></a><code class="title"><img src="../images/icons/method.png" alt="method" title="method"></img><img src="../images/icons/visibility_protected.png" style="margin-right: 5px" alt="protected"></img><span class="highlight">targetedSearch</span><span class="nb-faded-text">(<a href="../files/unknown_type.html">\unknown_type</a> $searchHash)</span> : void</code><div class="description"><span class="attribute">static</span><p class="short_description">Search only the listed fields for the exact values</p></div><div class="code-tabs"><div class="long-description"></div><strong>Parameters</strong><table class="argument-info"><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tr><th>$searchHash</th><td><a href="../files/unknown_type.html">\unknown_type</a></td><td><em></em></td></tr></table></div><div class="clear"></div></div></div></div></div><small class="footer">
            Documentation was generated by
            <a href="http://phpdoc.org">phpDocumentor
                2.2.0
</a>.
        </small></body></html>
